# envs/prod/prod.tfvars
# 프로덕션 환경에 대한 Terraform 변수 값 정의
# 이 파일은 envs/prod/main.tf에서 참조되는 변수들의 실제 값을 제공합니다.

# =============================================================================
# 프로젝트 기본 설정
# =============================================================================
project_name = "portfogram"     # 프로젝트 이름 (리소스 이름 prefix에 사용)
aws_region   = "ap-northeast-2" # AWS 리전 (서울)

# =============================================================================
# 네트워크 설정
# =============================================================================
# VPC CIDR은 프로덕션 환경에 적합한 크기로 설정 (/16 = 65,536개 IP 주소)
vpc_cidr = "10.2.0.0/16"

# 각 가용영역당 하나의 public/private 서브넷 쌍 생성
# public_subnets: 로드밸런서, NAT 게이트웨이 등 인터넷 접근이 필요한 리소스용
public_subnets_cidr = [
  "10.2.0.0/24", # ap-northeast-2a 
  "10.2.1.0/24", # ap-northeast-2b
  "10.2.2.0/24"  # ap-northeast-2c (프로덕션은 3개 AZ 권장)
]

# private_subnets: EKS 노드 그룹 등 외부에 직접 노출되지 않는 리소스용
private_subnets_cidr = [
  "10.2.10.0/24", # ap-northeast-2a 
  "10.2.11.0/24", # ap-northeast-2b
  "10.2.12.0/24"  # ap-northeast-2c
]

# 고가용성을 위한 다중 가용영역 설정 (프로덕션은 3개 AZ 권장)
availability_zones = [
  "ap-northeast-2a",
  "ap-northeast-2b",
  "ap-northeast-2c"
]

# =============================================================================
# EKS 클러스터 설정
# =============================================================================
kubernetes_version = "1.28" # Kubernetes 버전 (1.25 ~ 1.28 사이)

# 프로덕션 환경에 적합한 노드 그룹 설정 (최대 성능 및 고가용성)
node_groups = {
  # 애플리케이션 워크로드용 노드 그룹
  app = {
    desired_size  = 5           # 프로덕션 환경을 위한 충분한 크기
    min_size      = 3           # 최소 크기 (고가용성 보장)
    max_size      = 10          # 최대 크기 (트래픽 급증 대비)
    disk_size     = 100         # GB (최소 20GB)
    instance_type = "t3.xlarge" # 프로덕션용 인스턴스 타입 (4 vCPU, 16GB RAM)
  }

  # 모니터링/관측성 도구용 노드 그룹
  monitoring = {
    desired_size  = 3          # 모니터링 도구를 위한 충분한 노드
    min_size      = 2          # 최소 크기 (고가용성 보장)
    max_size      = 5          # 최대 크기 (리소스 사용량 증가 시 확장)
    disk_size     = 200        # 모니터링 도구를 위한 더 큰 디스크 (장기 메트릭 저장)
    instance_type = "t3.2xlarge" # 모니터링용 더 큰 인스턴스 (8 vCPU, 32GB RAM)
  }
}

# =============================================================================
# 로드밸런서 설정
# =============================================================================
# Network Load Balancer 설정 (TCP 레벨 로드밸런싱)
target_port   = 80  # 대상 그룹 포트 (애플리케이션이 실제로 수신하는 포트)
listener_port = 443 # 리스너 포트 (클라이언트가 연결하는 포트, HTTPS)
# 참고: listener_port 443에서 들어온 트래픽을 target_port 80으로 포워딩
#       (SSL/TLS 종료는 별도로 구성하거나 애플리케이션 레벨에서 처리)

